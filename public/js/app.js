import Navigo from'navigo';import User from'userController';import*as data from'data';import{CONSTANTS as CONSTANTS}from'constants';import{VALIDATOR as VALIDATOR}from'validator';import'facebookHelper';import{get as homeController}from'homeController';import{get as invalidController}from'invalidController';import{get as registerController}from'registerController';import{get as signInController}from'signInController';import{get as currentUserController}from'currentUserController';import{get as currentUserCollectionsController}from'currentUserCollectionsController';import{get as createNewCollectionController}from'createNewCollectionController';import{get as collectionManageController}from'collectionManageController';import{get as viewItemsController}from'viewItemsController';const root=null;const useHash=false;const hash='#!';const router=new Navigo(root,useHash,hash);router.on('/',()=>{router.navigate('#/home');}).on('/home',()=>{$.when(homeController()).then(()=>{$('.collection-view-btn').click((ev)=>{const key=$(ev.target).next().html();$('#key-container').html(key);router.navigate('#/view-items/');});});}).on('/signin',()=>{$.when(signInController()).then();}).on('/user/*',()=>{$.when(currentUserController()).then(()=>{$('#new-collection').on('click',function(){router.navigate('#/create-collection/');});$('#view-collections').on('click',function(){router.navigate('#/collections/');});});}).on('/collections/',()=>{$.when(currentUserCollectionsController()).then(()=>{$('.collection-manage-btn').click((ev)=>{const key=$(ev.target).next().html();$('#key-container').html(key);router.navigate('#/collection-manage/');});$('.collection-delete-btn').click((ev)=>{const key=$(ev.target).prev().html();data.deleteCollection(key);$(ev.target).parent().parent().remove();toastr.warning(CONSTANTS.COLLECTION_DELETED);});$('.collection-view-btn').click((ev)=>{const key=$(ev.target).next().next().html();$('#key-container').html(key);router.navigate('#/view-items/');});});}).on('/create-collection/',()=>{$.when(createNewCollectionController()).then(()=>{$('#create-collection-btn').on('click',function(){const items=[];const type=$('#inputCollectionType').val();const description=$('#inputCollectionDescription').val();VALIDATOR.checkIfValidCollectionType(type);VALIDATOR.checkIfValidCollectionDescription(description);const isPrivate=!$('#isPublic').is(':checked');data.writeNewCollection(items,type,description,isPrivate);router.navigate('#/collections/');});});}).on('/collection-manage/',()=>{$.when(collectionManageController()).then(()=>{$('#item-add-btn').click((ev)=>{const collectionId=$('#key-container').html();const itemToSearch=$('#itemToSearch').val();const itemToSearchType=$('#itemToSearchLabel').html();VALIDATOR.checkIfValidItemName(itemToSearch);if(itemToSearchType.indexOf('movie')>=0){const requestUrl='https://www.omdbapi.com/?t="';$.get(requestUrl+itemToSearch+'"').then((jsonData)=>{VALIDATOR.validateJsonObject(jsonData);data.writeNewItem(collectionId,jsonData.Title,jsonData.Poster,jsonData.Plot);$('#itemToSearch').val('');toastr.success(CONSTANTS.MOVIE_ADDED);});}
if(itemToSearchType.indexOf('song')>=0){const requestUrl='https://api.spotify.com/v1/search?q="'+itemToSearch+'"&type=track';$.get(requestUrl).then((jsonData)=>{VALIDATOR.validateJsonObject(jsonData);jsonData=Object.values(jsonData)[0].items[0];const durationMS=jsonData.duration_ms;const durationMin=(durationMS / 1000 / 60)<<0;const durationSeconds=Math.floor((durationMS / 1000)%60);const albumName=jsonData.album.name;const artistName=jsonData.artists[0].name;const description='Singer: '+artistName+' Duration: '+durationMin+':'+durationSeconds+' From: "'+albumName+'" album';const imageLink=jsonData.album.images[0].url;$('#itemToSearch').val('');data.writeNewItem(collectionId,jsonData.name,imageLink,description);toastr.success(CONSTANTS.SONG_ADDED);});}
if(itemToSearchType.indexOf('book')>=0){$.ajax('https://www.googleapis.com/books/v1/volumes?q="'+itemToSearch+'"').then((jsonData)=>{VALIDATOR.validateJsonObject(jsonData);jsonData=Object.values(jsonData);jsonData=jsonData[2][0].volumeInfo;const title=jsonData.title;const href=jsonData.imageLinks.thumbnail;const description=jsonData.description;data.writeNewItem(collectionId,title,href,description);$('#itemToSearch').val('');toastr.success(CONSTANTS.BOOK_ADDED);});}});}).then(()=>{$('.item-btn-delete').click((ev)=>{const collectionId=$('#key-container').html();const itemKey=$(ev.target).next().html();data.deleteItem(itemKey,collectionId);$(ev.target).parent().parent().remove();toastr.warning(CONSTANTS.ITEM_DELETED);});});}).on('/view-items',()=>{$.when(viewItemsController()).then();}).on('/view-items/:collectionID',(params)=>{$.when(viewItemsController(params)).then();}).on('/register',()=>{$.when(registerController()).then();}).resolve();router.notFound(function(){invalidController();});User.initAuthStatusChange();$('#sign-in-btn').click(()=>{if($('#sign-in-btn').text()==='Sign out'){User.signOut();toastr.success(CONSTANTS.USER_SIGNED_OUT);}});export{router,};